---
title:  <span style="font-size:12pt">「料紙研究の最新手法と成果」関連データ</span>
author: <span style="font-size:10pt">渋谷綾子</span> 
output: 
 html_document: default
 word_document:
    fig_width: 7
    fig_height: 5
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

　このファイルは，2020年10月12日（月）東京大学史料編纂所前近代日本史情報国際センター・画像史料解析センター共同研究会の資料作成に使用したRマークダウンのコードである。  
　Fig1は、現生標本（イネ，アワ，キビ，ヒエ）と松尾大社社蔵史料で確認された料紙のデンプン粒（イネ，トロロアオイ，種不明）について，Fig2は同じく現生標本と陽明文庫所蔵史料で確認された料紙のデンプン粒（イネ，トロロアオイ，種不明）について，粒径の比較・検討を行い，それぞれの特徴を可視化した。デンプン粒の粒径範囲は標本によって左右されるが（藤本），
　デンプン粒の粒径範囲は標本によって左右されるが（註21論文），現生標本は渋谷（2010）で計測したデータ（任意で20個抽出）にもとづくものである。松尾大社社蔵史料の料紙におけるデンプン粒は，調査史料90点の撮影箇所における計測結果を用いており，イネ223個，トロロアオイ30個，種不明106個である。陽明文庫所蔵史料の料紙のデンプン粒は，調査史料63点の撮影箇所における計測結果を用いており，イネ329個（函番号11：89個，函番号47：223個，函番号132：17個），トロロアオイ111個（函番号11：49個，函番号47：42個，函番号47：20個），種不明3個（函番号11のみ）である。  
　Fig3は，松尾大社社蔵史料の年代と細胞組織／柔組織，繊維の含有量について，それぞれ撮影1箇所あたりの計測数を表す。2018年度・2019年度の調査史料63点における含有状況であり，松尾大社のすべての史料を網羅しているわけではないことを断っておく。  
　Fig4は，
<p>

```{r, message=FALSE, comment=""}
# パッケージの読み込み
library(ggplot2)
library(readr)
library(tidyverse)
library(knitr)
library(rmarkdown)
library(revealjs)
library(scales)
library(reshape2)
```

```{r, message=FALSE, comment=""}
# Fig1作成のためのCSVファイルの読み取り
starch <- read_csv("matsuono_ryoshi-starch.csv")
```

```{r, message=FALSE, comment=""}
head(starch)　 # データフレームの上6行を表示
names(starch)  # starchに含まれるすべての変数名
dim(starch)　  # starchに含まれる観測数と変数の数を表示させる 
```

```{r, message=FALSE, comment=""}
# Fig1 現生デンプン粒標本と松尾大社社蔵史料の料紙に含有されたデンプン粒の粒径比較図
n_fun <- function(x){
return(data.frame(y = max(x)+3.5, label = paste0("n = ",length(x))))
}

ggplot(starch, aes(x = デンプン粒の種類, y = 粒径範囲)) +
  geom_violin(trim=T,fill="#005aff",linetype="blank",alpha=I(1/3),adjust=2.5)+ # バイオリンプロット作成
  stat_summary(geom="pointrange",fun = mean, fun.min = function(x) mean(x)-sd(x), 
               fun.max = function(x) mean(x)+sd(x), size=.5,alpha=.5)+ # 平均値±標準偏差をプロット
  stat_summary(fun.data = n_fun, geom = "text",colour="black",size=4)+ # 各グループのデータ数を最大値の位置に追加
  scale_y_continuous(breaks = c(0,10,20,30,40,50), limits = c(0,50), expand = c(0,0))+ # 数値軸の目盛りを指定
  scale_x_discrete(limit=c("トロロアオイ_松尾","種不明_松尾","イネ_松尾","現生イネ","現生アワ","現生キビ","現生ヒエ")) +
  # 文字軸の順番を指定
  coord_flip() +　# 90度横向きにする
  labs(x = "デンプン粒の種類", y = "粒径範囲（μm）") + # ラベルの指定
  theme_classic()
ggsave(file = "fig1.png", dpi = 300) # ファイルの保存
```

```{r, message=FALSE, comment=""}
# Fig2作成のためのCSVファイルの読み取り
starch <- read_csv("yomei-starch.csv")
```

```{r, message=FALSE, comment=""}
head(starch)　 # データフレームの上6行を表示
names(starch)  # starchに含まれるすべての変数名
dim(starch)　  # starchに含まれる観測数と変数の数を表示させる 
```

```{r, message=FALSE, comment=""}
# Fig2 現生デンプン粒標本と料紙に含有されたデンプン粒の粒径比較図
n_fun <- function(x){
return(data.frame(y = max(x)+2.5, label = paste0("n = ",length(x))))
}

ggplot(starch, aes(x = デンプン粒の種類, y = 粒径範囲)) +
  geom_violin(trim=T,fill="#005aff",linetype="blank",alpha=I(1/3),adjust=2.5)+ # バイオリンプロット作成
  stat_summary(geom="pointrange",fun = mean, fun.min = function(x) mean(x)-sd(x), 
               fun.max = function(x) mean(x)+sd(x), size=.5,alpha=.5)+ # 平均値±標準偏差をプロット
  stat_summary(fun.data = n_fun, geom = "text",colour="black",size=4)+ # 各グループのデータ数を最大値の位置に追加
  scale_y_continuous(breaks = c(0,10,20,30), limits = c(0,30), expand = c(0,0))+ # 数値軸の目盛りを指定
  scale_x_discrete(limit=c("トロロアオイ_函11","トロロアオイ_函47","トロロアオイ_函132","種不明_函11","イネ_函11","イネ_函47","イネ_函132","現生イネ","現生アワ","現生キビ","現生ヒエ")) + # 文字軸の順番を指定
  coord_flip() +　# 90度横向きにする
  labs(x = "デンプン粒の種類", y = "粒径範囲（μm）") + # ラベルの指定
  theme_classic()
ggsave(file = "fig2.png", dpi = 300) # ファイルの保存
```

```{r, message=FALSE, comment=""}
# Fig3作成のためのCSVファイルの読み取り
tissue <- read_csv("matsunoo_tissue-fibre.csv")
```

```{r, message=FALSE, comment=""}
head(tissue)　 # データフレームの上6行を表示
names(tissue)  # tissue-fibreに含まれるすべての変数名
dim(tissue)　  # tissue-fibreに含まれる観測数と変数の数を表示させる 
```

```{r, message=FALSE, comment=""}
# Fig3(1)　松尾大社社蔵史料の年代別にみた細胞組織・柔細胞の含有状況
ggplot(tissue, aes(x = 西暦, y = 細胞組織)) +
  geom_area(colour = "#005aff", fill ="#005aff", alpha=0.5) + # 網掛け領域付きの折れ線グラフの作成
  scale_x_continuous(breaks = c(1160,1200,1300,1400,1500,1600,1700,1800,1860), 
                     limits = c(1160,1870), expand = c(0,0)) + # X軸の目盛りを指定
  scale_y_continuous(breaks = c(0,10,20,30,40,50,60,70,80,90), limits = c(0,90), expand = c(0,0))+ # Y軸の目盛りを指定
  labs(x = "史料の年代（西暦）", y = "計測数") + # ラベルの指定
  theme_classic()
ggsave(file = "fig3-1.png", width = 6, height = 4, dpi = 300) # ファイルの保存
```

```{r, message=FALSE, comment=""}
# Fig3(2)　松尾大社社蔵史料の年代別にみた繊維の含有状況
ggplot(tissue, aes(x = 西暦, y = 繊維)) +
  geom_area(colour = "#005aff", fill ="#005aff", alpha=0.5) + # 網掛け領域付きの折れ線グラフの作成
  scale_x_continuous(breaks = c(1160,1200,1300,1400,1500,1600,1700,1800,1860), 
                     limits = c(1160,1870), expand = c(0,0)) + # X軸の目盛りを指定
  scale_y_continuous(breaks = c(0,2,4,6,8,10), limits = c(0,10), expand = c(0,0))+ # Y軸の目盛りを指定
  labs(x = "史料の年代（西暦）", y = "計測数") + # ラベルの指定
  theme_classic()
ggsave(file = "fig3-2.png", width = 6, height = 4, dpi = 300) # ファイルの保存
```
